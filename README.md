# מעבדת הספרייה – גרסת לוח מובילים משותף

בקובץ זה תמצאו את קוד הפורטל המלא, כולל חיבור ל־Google Sheets עבור לוח מובילים משותף.

## מה כלול

- `index.html` – הקוד המרכזי של הפורטל. יש לעדכן בו שני משתנים בראש הקובץ:
  - `API_URL` – כתובת ה־Web App של Apps Script שיפעל על הגיליון.
  - `API_TOKEN` – אסימון סודי שבחרתם וששמרתם בהגדרות הסקריפט.
- `404.html` – דף עוקף 404 שמפנה חזרה לשורש האתר. נדרש בגירסת GitHub Pages כדי לאפשר עבודה חלקה כ־SPA.
- `google_script.js` – קוד ה־Apps Script שמטפל בקריאות API. העתקו אותו כפי שהוא לסביבת Apps Script.

## שלבי התקנה

### 1. יצירת גיליון

1. פתחו Google Sheets חדש (למשל בשם `AI Library Portal`).
2. קראו לשונית אחת בשם `Scores` והכינו את כותרות העמודות בשורה 1:

   | A         | B     | C      | D         |
   |-----------|-------|--------|-----------|
   | user_id   | alias | points | updated_at |

3. מומלץ להקפיא את שורה 1 כדי שתמיד תישאר גלויה.

### 2. יצירת Apps Script (API)

1. בתוך Google Sheets, עברו ל־**Extensions → Apps Script**.
2. מחקו את הקוד הקיים והדביקו לתוך הקובץ את כל התוכן של `google_script.js` שנמצא בריפו (ראו מטה). מדובר ב־API קטן שמטפל בשליפת לוח מובילים (`route=leaderboard`) והכנסת/עדכון ציון (`route=upsertScore`).
3. צרו אסימון סודי להגנה מפני כתיבה חיצונית:
   - לחץ על **Project Settings** (סמל גלגל שיניים), בחר `Script properties`, ולחץ על **Add row**.
   - בשדה `Property` כתבו `TOKEN` ובשדה `Value` כתבו אסימון סודי לבחירתכם (לדוגמה: `P0rtal!234`). לחצו **Save properties**.
4. פריסת ה־Web App:
   - בחרו **Deploy → New deployment**.
   - בחרו סוג **Web app**.
   - הגדרות:
     - **Execute as:** `Me` (או בהתאם לחשבון).
     - **Who has access:** `Anyone` (כדי לאפשר קריאה ללא צורך בהרשאה).
   - לחצו **Deploy**, אשרו הרשאות, וקבלו את קישור ה־Web App (כתובת שמסתיימת ב־`/exec`).
   - שמרו את הקישור — תזדקקו לו כערך `API_URL` ב־`index.html`.

### 3. עדכון משתני החיבור בפורטל

ב־`index.html` (שבשורש התיקייה) יש לחפש את החלק הבא בראש הקובץ:

```js
// ======== CONFIGURE THESE VALUES ========
const API_URL = 'REPLACE_WITH_YOUR_APPS_SCRIPT_URL';
const API_TOKEN = 'REPLACE_WITH_YOUR_TOKEN';
// =========================================
```

והחליפו:

- את `'REPLACE_WITH_YOUR_APPS_SCRIPT_URL'` בכתובת ה־Web App שקיבלתם לאחר הפריסה.
- את `'REPLACE_WITH_YOUR_TOKEN'` באסימון שבחרתם ושמירתם ב־Script properties.

שמרו והעלו מחדש את הקובץ ל־GitHub (או לשרת בו אתם מאחסנים את האתר).

### 4. העלאת האתר ל־GitHub Pages

1. יצירת ריפוזיטורי פומבי ב־GitHub (למשל בשם `ai-library-portal`).
2. העלו את כל הקבצים של התיקייה (אל תעלו את התיקייה עצמה אלא את תוכנה: `index.html`, `404.html`, `README.md` ו־`google_script.js`).
3. הפעלת Pages:
   - Settings → Pages.
   - Source: `main`.
   - Folder: `/ (root)`.
   - Save.
4. לאחר מספר דקות תקבלו קישור לאתר, למשל: `https://username.github.io/ai-library-portal/`.

## google_script.js – קוד ה־Apps Script

הקובץ `google_script.js` מכיל את הלוגיקה ל־API. בעת הדבקה ל־Apps Script, ודאו שהוא מועתק בשלמותו. הקוד כולל שתי פונקציות עיקריות:

- `handleGet` – מחזירה את לוח המובילים (Leaderboard) ממויין ומשורשר ל־JSON.
- `handlePost` – מעדכנת או מכניסה שורה חדשה לגיליון בעת שליחת נקודות ממשתמש.

הקוד מוסיף כותרות Access-Control-Allow-Origin כדי לאפשר קריאות מהדפדפן ומבצע אימות בסיסי באמצעות ה־TOKEN שהוגדר בהגדרות הסקריפט.

## שאלות נפוצות

1. **למה משתמשים שונים לא ראו זה את זה לפני כן?** – המערכת התבססה על `localStorage`, ששומר את הנתונים רק בדפדפן המקומי של כל משתמש. באמצעות Google Sheets אנו מחזיקים כעת נתונים משותפים בענן, וכל משתמש המעודכן מפרסם ומקבל את הנתונים מהגיליון.

2. **האם ניתן להוסיף תכונות נוספות?** – כן. ניתן ליצור גיליונות נוספים ל״קיר הקהילה״, מדליות, תגובות ועוד. פשוט הוסיפו עמודות וכתבו פונקציות נוספות ל־Apps Script וקריאות המתאימות ב־React.

בהצלחה בהטמעת הפורטל!